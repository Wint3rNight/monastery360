<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Virtual Tours - Sikkim Monasteries</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <script crossorigin src="https://unpkg.com/react@18/umd/react.production.min.js"></script>
    <script crossorigin src="https://unpkg.com/react-dom@18/umd/react-dom.production.min.js"></script>
    <script src="https://unpkg.com/@babel/standalone/babel.min.js"></script>
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@300;400;500;600;700;800;900&display=swap" rel="stylesheet">
    <style>
        * { margin: 0; padding: 0; box-sizing: border-box; }
        body { font-family: 'Inter', sans-serif !important; overflow-x: hidden; }
        #root { width: 100vw; min-height: 100vh; }
        :root {
            --brand-500: #f59e0b;
            --brand-600: #d97706;
            --accent-400: #fbbf24;
        }

        /* subtle fade-up entrance for cards */
        @keyframes fadeUp {
          from { opacity: 0; transform: translateY(8px); }
          to   { opacity: 1; transform: translateY(0); }
        }

        .tour-grid > * {
          opacity: 0;
          transform: translateY(8px);
          animation-name: fadeUp;
          animation-duration: 520ms;
          animation-fill-mode: both;
          animation-timing-function: cubic-bezier(.2,.8,.2,1);
          /* default delay overridden by per-item classes */
        }

        /* small set of delay utility classes for staggered entrance */
        .delay-0{ animation-delay: 0s; }
        .delay-1{ animation-delay: 0.06s; }
        .delay-2{ animation-delay: 0.12s; }
        .delay-3{ animation-delay: 0.18s; }
        .delay-4{ animation-delay: 0.24s; }
        .delay-5{ animation-delay: 0.30s; }
        .delay-6{ animation-delay: 0.36s; }
        .delay-7{ animation-delay: 0.42s; }
        .delay-8{ animation-delay: 0.48s; }
        .delay-9{ animation-delay: 0.54s; }
        .delay-10{ animation-delay: 0.60s; }
        .delay-11{ animation-delay: 0.66s; }

        /* Hide all Google Translate elements completely */
        #google_translate_element,
        .goog-te-gadget,
        .goog-te-gadget-simple,
        .goog-te-gadget-icon,
        .goog-te-banner-frame,
        .goog-te-menu-frame,
        .goog-te-ftab,
        .skiptranslate,
        body > .skiptranslate,
        iframe.goog-te-menu-frame,
        .goog-te-menu2,
        .goog-te-combo {
            display: none !important;
            visibility: hidden !important;
            opacity: 0 !important;
            height: 0 !important;
            width: 0 !important;
            position: absolute !important;
            top: -9999px !important;
            left: -9999px !important;
        }

        /* Prevent Google Translate from modifying the page layout */
        body.goog-te-rendered {
            position: relative !important;
            top: 0 !important;
            left: 0 !important;
        }

        /* Hide the top banner that Google Translate adds */
        body > .skiptranslate {
            display: none !important;
        }

        body.translated {
            margin-top: 0 !important;
        }
    </style>
</head>
<body>
    <div id="root"></div>

    <!-- Pass Django authentication state to JavaScript -->
    <script>
        window.userAuthenticated = {{ user.is_authenticated|yesno:"true,false" }};
        window.userName = "{{ user.get_full_name|default:user.username|escapejs }}";
        window.userEmail = "{{ user.email|escapejs }}";
    </script>

    <!-- CSRF Token for forms -->
    {% csrf_token %}
    <script>
        window.csrfToken = document.querySelector('[name=csrfmiddlewaretoken]').value;
    </script>

    <script type="text/babel">
        const { useState, useEffect } = React;

        // Shared Navigation Component
        const SharedNavigation = ({ currentPage = "", theme = "dark" }) => {
          const [isMobileMenuOpen, setIsMobileMenuOpen] = useState(false);

          // Navigation items with their routes and icons
          const navItems = [
            {
              name: "Home",
              href: "/",
              icon: (
                <svg className="w-4 h-4" viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2">
                  <path d="M3 9L12 2L21 9V20A2 2 0 0 1 19 22H5A2 2 0 0 1 3 20V9Z"/>
                </svg>
              )
            },
            {
              name: "Virtual Tours",
              href: "/tours/",
              icon: (
                <svg className="w-4 h-4" viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2">
                  <circle cx="12" cy="12" r="10"/>
                  <path d="M2 12H22"/>
                  <path d="M12 2A15.3 15.3 0 0 1 16 12A15.3 15.3 0 0 1 12 22A15.3 15.3 0 0 1 8 12A15.3 15.3 0 0 1 12 2Z"/>
                </svg>
              )
            },
            {
              name: "Interactive Map",
              href: "/monasteries/map/",
              icon: (
                <svg className="w-4 h-4" viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2">
                  <path d="M21 10C21 17 12 23 12 23S3 17 3 10A9 9 0 0 1 21 10Z"/>
                  <circle cx="12" cy="10" r="3"/>
                </svg>
              )
            },
            {
              name: "Digital Archives",
              href: "/archives/portal/",
              icon: (
                <svg className="w-4 h-4" viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2">
                  <path d="M14 2H6A2 2 0 0 0 4 4V20A2 2 0 0 0 6 22H18A2 2 0 0 0 20 20V8L14 2Z"/>
                  <polyline points="14,2 14,8 20,8"/>
                </svg>
              )
            },
            {
              name: "Cultural Calendar",
              href: "/events/",
              icon: (
                <svg className="w-4 h-4" viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2">
                  <rect x="3" y="4" width="18" height="18" rx="2" ry="2"/>
                  <line x1="16" y1="2" x2="16" y2="6"/>
                  <line x1="8" y1="2" x2="8" y2="6"/>
                  <line x1="3" y1="10" x2="21" y2="10"/>
                </svg>
              )
            }
          ];

          // Theme configurations
          const themeClasses = {
            light: {
              header: "bg-white shadow-sm",
              text: "text-gray-900",
              subtext: "text-gray-600",
              navText: "text-gray-700",
              navHover: "hover:text-orange-500",
              activeText: "text-orange-500",
              mobileBorder: "border-gray-200"
            },
            dark: {
              header: "bg-gray-900 shadow-lg",
              text: "text-white",
              subtext: "text-gray-400",
              navText: "text-gray-300",
              navHover: "hover:text-orange-500",
              activeText: "text-orange-500",
              mobileBorder: "border-gray-700"
            },
            transparent: {
              header: "bg-white/10 backdrop-blur-sm",
              text: "text-white",
              subtext: "text-white/70",
              navText: "text-white",
              navHover: "hover:text-orange-400",
              activeText: "text-orange-400",
              mobileBorder: "border-white/20"
            }
          };

          const currentTheme = themeClasses[theme] || themeClasses.dark;

          return (
            <header className={`sticky top-0 z-50 py-4 px-8 ${currentTheme.header}`}>
              <div className="flex items-center justify-between">
                {/* Logo */}
                <button
                  onClick={() => window.location.reload()}
                  className="flex items-center space-x-3 hover:opacity-80 transition-opacity cursor-pointer"
                >
                  <div className="w-12 h-12 text-orange-500">
                    <svg viewBox="0 0 24 24" fill="currentColor" className="w-full h-full">
                      <path d="M12 2L3 7V10.5L12 15.5L21 10.5V7L12 2ZM12 4.2L18.4 7.5L12 10.8L5.6 7.5L12 4.2ZM5 9.1L11 12.1V19.9L5 16.9V9.1ZM13 19.9V12.1L19 9.1V16.9L13 19.9Z"/>
                      <path d="M12 1L2 6V11L12 16L22 11V6L12 1ZM4 8.5V9.5L12 14L20 9.5V8.5L12 13L4 8.5Z"/>
                    </svg>
                  </div>
                  <div>
                    <h1 className={`text-xl font-bold ${currentTheme.text}`}>Sikkim Monasteries</h1>
                    <p className={`text-sm ${currentTheme.subtext}`}>Heritage & Culture</p>
                  </div>
                </button>

                {/* Desktop Navigation */}
                <nav className="hidden lg:flex items-center space-x-8">
                  {navItems.map((item) => {
                    const isActive = currentPage === "tours" && item.name === "Virtual Tours";
                    return (
                      <a
                        key={item.name}
                        href={item.href}
                        className={`flex items-center space-x-2 transition-colors ${
                          isActive
                            ? `${currentTheme.activeText} font-semibold`
                            : `${currentTheme.navText} ${currentTheme.navHover}`
                        }`}
                      >
                        {item.icon}
                        <span>{item.name}</span>
                      </a>
                    );
                  })}

                  {/* Language Switcher */}
                  <div className="language-switcher relative mr-4">
                    <button
                      onClick={(e) => {
                        e.stopPropagation();
                        const menu = document.getElementById('languageMenu');
                        if (menu) {
                          menu.classList.toggle('hidden');
                        }
                      }}
                      className="notranslate flex items-center space-x-2 px-4 py-2 bg-indigo-600 hover:bg-indigo-700 text-white rounded-lg font-medium transition-all duration-200 border border-indigo-500"
                      translate="no"
                    >
                      <i className="fas fa-globe"></i>
                      <span id="currentLanguage" className="notranslate" translate="no">English</span>
                      <i className="fas fa-chevron-down text-xs"></i>
                    </button>

                    <div id="languageMenu" className="notranslate hidden absolute right-0 mt-2 w-48 bg-white rounded-lg shadow-lg border border-gray-200 z-50" translate="no">
                      <div className="py-2">
                        <button
                          onClick={() => changeLanguage('en', 'English')}
                          className="notranslate w-full text-left px-4 py-2 hover:bg-gray-100 flex items-center space-x-2 text-gray-800"
                          translate="no"
                        >
                          <span className="w-6 text-center">ðŸ‡ºðŸ‡¸</span>
                          <span>English</span>
                        </button>
                        <button
                          onClick={() => changeLanguage('hi', 'à¤¹à¤¿à¤‚à¤¦à¥€')}
                          className="notranslate w-full text-left px-4 py-2 hover:bg-gray-100 flex items-center space-x-2 text-gray-800"
                          translate="no"
                        >
                          <span className="w-6 text-center">ðŸ‡®ðŸ‡³</span>
                          <span>à¤¹à¤¿à¤‚à¤¦à¥€ (Hindi)</span>
                        </button>
                        <button
                          onClick={() => changeLanguage('ne', 'à¤¨à¥‡à¤ªà¤¾à¤²à¥€')}
                          className="notranslate w-full text-left px-4 py-2 hover:bg-gray-100 flex items-center space-x-2 text-gray-800"
                          translate="no"
                        >
                          <span className="w-6 text-center">ðŸ‡³ðŸ‡µ</span>
                          <span>à¤¨à¥‡à¤ªà¤¾à¤²à¥€ (Nepali)</span>
                        </button>
                      </div>
                    </div>
                  </div>

                  {/* Authentication Buttons */}
                  {window.userAuthenticated ? (
                    <>
                      <a href="/profile/" className="bg-purple-500 hover:bg-purple-600 text-white px-4 py-2 rounded-lg font-medium transition-colors flex items-center space-x-2">
                        <svg className="w-4 h-4" viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2">
                          <path d="M20 21V19A4 4 0 0 0 16 15H8A4 4 0 0 0 4 19V21"/>
                          <circle cx="12" cy="7" r="4"/>
                        </svg>
                        <span>Profile</span>
                      </a>
                      <form method="post" action="/logout/" className="inline-block">
                        <input type="hidden" name="csrfmiddlewaretoken" value={window.csrfToken} />
                        <button type="submit" className="bg-red-500 hover:bg-red-600 text-white px-4 py-2 rounded-lg font-medium transition-colors flex items-center space-x-2">
                          <svg className="w-4 h-4" viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2">
                            <path d="M9 21H5A2 2 0 0 1 3 19V5A2 2 0 0 1 5 3H9"/>
                            <polyline points="16,17 21,12 16,7"/>
                            <line x1="21" y1="12" x2="9" y2="12"/>
                          </svg>
                          <span>Logout</span>
                        </button>
                      </form>
                    </>
                  ) : (
                    <a href="/login/" className="bg-orange-500 hover:bg-orange-600 text-white px-4 py-2 rounded-lg font-medium transition-colors flex items-center space-x-2">
                      <svg className="w-4 h-4" viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2">
                        <path d="M15 3H19A2 2 0 0 1 21 5V19A2 2 0 0 1 19 21H15"/>
                        <polyline points="10,17 15,12 10,7"/>
                        <line x1="15" y1="12" x2="3" y2="12"/>
                      </svg>
                      <span>Login</span>
                    </a>
                  )}
                </nav>

                {/* Mobile Menu Button */}
                <button
                  onClick={() => setIsMobileMenuOpen(!isMobileMenuOpen)}
                  className={`lg:hidden ${currentTheme.navText}`}
                >
                  <svg className="w-6 h-6" viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2">
                    <line x1="3" y1="6" x2="21" y2="6"/>
                    <line x1="3" y1="12" x2="21" y2="12"/>
                    <line x1="3" y1="18" x2="21" y2="18"/>
                  </svg>
                </button>
              </div>

              {/* Mobile Navigation */}
              {isMobileMenuOpen && (
                <nav className={`lg:hidden mt-4 pt-4 border-t ${currentTheme.mobileBorder}`}>
                  <div className="flex flex-col space-y-4">
                    {navItems.map((item) => {
                      const isActive = currentPage === "tours" && item.name === "Virtual Tours";
                      return (
                        <a
                          key={item.name}
                          href={item.href}
                          className={`flex items-center space-x-2 transition-colors ${
                            isActive
                              ? `${currentTheme.activeText} font-semibold`
                              : `${currentTheme.navText} ${currentTheme.navHover}`
                          }`}
                        >
                          {item.icon}
                          <span>{item.name}</span>
                        </a>
                      );
                    })}

                    {/* Mobile Login Button */}
                    <a
                      href="/login/"
                      className="bg-orange-500 hover:bg-orange-600 text-white px-4 py-2 rounded-lg font-medium transition-colors flex items-center space-x-2 w-fit"
                    >
                      <svg className="w-4 h-4" viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2">
                        <path d="M15 3H19A2 2 0 0 1 21 5V19A2 2 0 0 1 19 21H15"/>
                        <polyline points="10,17 15,12 10,7"/>
                        <line x1="15" y1="12" x2="3" y2="12"/>
                      </svg>
                      <span>Login</span>
                    </a>
                  </div>
                </nav>
              )}
            </header>
          );
        };

        // Hero Component
        const Hero = ({ searchTerm, setSearchTerm, selectedRegion, setSelectedRegion, handleSearch }) => {
          const regions = ["All Regions", "East Sikkim", "West Sikkim", "North Sikkim", "South Sikkim"];

          return (
      <section className="relative h-96 flex items-center justify-center shadow-inner">
              {/* Background Image */}
              <div className="absolute inset-0">
                <img
                  src="https://images.unsplash.com/photo-1594368952328-78a746b5a376?q=80&w=2070&auto=format&fit=crop"
                  alt="Monastery in mountains"
                  className="w-full h-full object-cover"
                />
                <div className="absolute inset-0 bg-gradient-to-r from-blue-900/60 to-purple-900/60"></div>
              </div>

              {/* Content */}
              <div className="relative z-10 text-center px-4 max-w-4xl mx-auto">
          <h1 className="text-4xl md:text-6xl font-extrabold tracking-tight text-white mb-4">Virtual Tours</h1>
                <p className="text-lg md:text-xl text-white/90 mb-8 max-w-2xl mx-auto leading-relaxed">
                  Experience the sacred architecture and spiritual atmosphere of Sikkim's monasteries through immersive 360Â° virtual tours.
                </p>

                {/* Search Controls */}
                <div className="flex flex-col md:flex-row gap-4 justify-center items-center max-w-2xl mx-auto">
          <input
                    type="text"
                    placeholder="Search monasteries..."
                    value={searchTerm}
                    onChange={(e) => setSearchTerm(e.target.value)}
            className="w-full md:flex-1 px-4 py-3 rounded-xl border border-gray-200 bg-white/90 backdrop-blur-sm focus:outline-none focus:ring-2 focus:ring-orange-400 shadow-sm"
                  />
                  <select
                    value={selectedRegion}
                    onChange={(e) => setSelectedRegion(e.target.value)}
                    className="w-full md:w-auto px-4 py-3 rounded-lg border border-gray-300 focus:outline-none focus:ring-2 focus:ring-orange-500"
                  >
                    {regions.map(region => (
                      <option key={region} value={region}>{region}</option>
                    ))}
                  </select>
                  <button
                    onClick={handleSearch}
                    className="w-full md:w-auto bg-gradient-to-r from-orange-500 to-amber-400 text-white px-6 py-3 rounded-xl font-semibold hover:from-orange-600 hover:to-amber-500 transition-all shadow-lg transform hover:-translate-y-0.5"
                    aria-label="Search monasteries"
                  >
                    Search
                  </button>
                </div>
              </div>
            </section>
          );
        };

        // TourCard Component
        const TourCard = ({ monastery, idx=0 }) => {
          return (
            <div className={`bg-white rounded-xl shadow-lg overflow-hidden transform transition-all duration-300 hover:scale-105 hover:shadow-xl ${'delay-' + (idx % 12)}`}>
              {/* Image Container */}
              <div className="relative h-48">
                <img
                  src={monastery.imageUrl || 'https://images.unsplash.com/photo-1544735716-392fe2489ffa?q=80&w=1974&auto=format&fit=crop'}
                  alt={monastery.name}
                  className="w-full h-full object-cover"
                  onError={(e) => {
                    e.target.src = 'https://images.unsplash.com/photo-1544735716-392fe2489ffa?q=80&w=1974&auto=format&fit=crop';
                  }}
                />
                      {/* Featured Badge */}
                      {monastery.isFeatured && (
                        <div className="absolute top-3 left-3 bg-gradient-to-r from-yellow-400 to-orange-500 text-white text-xs font-bold px-3 py-1 rounded-full shadow">
                          FEATURED
                        </div>
                      )}

                      {/* Image overlay gradient for readable text */}
                      <div className="absolute inset-0 bg-gradient-to-t from-black/50 via-transparent to-transparent" aria-hidden="true"></div>
              </div>

              {/* Card Body */}
              <div className="p-6">
                <h3 className="text-xl font-bold text-gray-900 mb-2">{monastery.name}</h3>

                {/* Location */}
                <div className="flex items-center text-gray-600 mb-3">
                  <svg className="w-4 h-4 mr-1" viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2">
                    <path d="M21 10C21 17 12 23 12 23S3 17 3 10A9 9 0 0 1 21 10Z"/>
                    <circle cx="12" cy="10" r="3"/>
                  </svg>
                  <span className="text-sm">{monastery.region}</span>
                </div>

                <p className="text-gray-700 mb-4 text-sm leading-relaxed line-clamp-3">{monastery.description}</p>

                {
                  (() => {
                    const href = `/tours/monastery/${monastery.slug}/`;
                    return (
                      <a
                        href={(() => {
                          const slugify = (s) => s && s.toString().toLowerCase().trim().replace(/[^a-z0-9]+/g, '-').replace(/(^-|-$)/g, '');
                          const slug = monastery.slug || (monastery.panoId && monastery.panoId !== 'unknown' ? `${monastery.panoId}-monastery` : slugify(monastery.name));
                          if (!slug) console.warn('Could not compute slug for monastery:', monastery);
                          return `/tours/monastery/${slug}/`;
                        })()}
                        className="inline-flex items-center justify-center w-full bg-gradient-to-r from-orange-500 to-amber-400 text-white py-2 px-4 rounded-xl font-semibold hover:from-orange-600 hover:to-amber-500 transition-all shadow-2xl transform hover:-translate-y-0.5"
                        onClick={() => {}}
                        aria-label={`Explore ${monastery.name} now`}
                      >
                        <svg className="w-4 h-4 mr-2" viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2"><path d="M14 5L20 12L14 19"/><path d="M20 12H4"/></svg>
                        Explore Now
                      </a>
                    );
                  })()
                }
              </div>
            </div>
          );
        };

        // TourGallery Component
        const TourGallery = ({ monasteries, showAll, setShowAll }) => {
          const displayedMonasteries = showAll ? monasteries : monasteries.slice(0, 6);

          return (
            <section className="py-16 bg-gray-50">
              <div className="max-w-7xl mx-auto px-4 sm:px-6 lg:px-8">
                {/* Section Header */}
                <div className="text-center mb-12">
                  <h2 className="text-3xl md:text-4xl font-bold text-gray-900 mb-4">Virtual Tours Gallery</h2>
                  <p className="text-lg text-gray-600 max-w-3xl mx-auto">
                    Step inside sacred halls and explore the architectural marvels of Sikkim's monasteries through immersive 360Â° virtual experiences.
                  </p>
                </div>

                {/* Gallery Grid */}
          <div className="grid tour-grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-8 mb-12">
                    {displayedMonasteries.map((monastery, idx) => (
                      <TourCard key={monastery.id} monastery={monastery} idx={idx} />
                    ))}
                </div>

                {/* View All Button */}
                {!showAll && monasteries.length > 6 && (
                  <div className="text-center">
                    <button
                      onClick={() => setShowAll(true)}
                      className="bg-gray-900 text-white px-8 py-3 rounded-lg font-semibold hover:bg-gray-800 transition-colors"
                    >
                      View All Monasteries ({monasteries.length})
                    </button>
                  </div>
                )}

                {/* Show Less Button */}
                {showAll && monasteries.length > 6 && (
                  <div className="text-center">
                    <button
                      onClick={() => setShowAll(false)}
                      className="bg-gray-600 text-white px-8 py-3 rounded-lg font-semibold hover:bg-gray-700 transition-colors"
                    >
                      Show Less
                    </button>
                  </div>
                )}
              </div>
            </section>
          );
        };

        // Main App Component
        const App = () => {
          const [monasteries, setMonasteries] = useState([]);
          const [filteredMonasteries, setFilteredMonasteries] = useState([]);
          const [searchTerm, setSearchTerm] = useState('');
          const [selectedRegion, setSelectedRegion] = useState('All Regions');
          const [showAll, setShowAll] = useState(false);
          const [loading, setLoading] = useState(true);

          // Fetch data on component mount
          useEffect(() => {
            const fetchMonasteries = async () => {
              try {
                const response = await fetch('/static/data/monasteries.json');
                const data = await response.json();
                const list = (data.monasteries || data).map((m, i) => ({
                  id: m.id || i,
                  name: m.name,
                  slug: m.slug || null,
                  isFeatured: m.isFeatured || m.is_featured || false,
                  imageUrl: m.image || m.image_url || null,
                  region: m.district || m.region || 'Unknown',
                  description: m.short_description || m.description || '',
                  panoId: m.panoId || m.pano_id || null,
                }));
                setMonasteries(list);
                setFilteredMonasteries(list);
                setLoading(false);
              } catch (error) {
                console.error('Error fetching monasteries:', error);
                setLoading(false);
              }
            };

            fetchMonasteries();
          }, []);

          // Filter monasteries based on search and region
          useEffect(() => {
            let filtered = monasteries;

            // Filter by search term
            if (searchTerm) {
              filtered = filtered.filter(monastery =>
                monastery.name.toLowerCase().includes(searchTerm.toLowerCase())
              );
            }

            // Filter by region
            if (selectedRegion !== 'All Regions') {
              filtered = filtered.filter(monastery =>
                monastery.region === selectedRegion
              );
            }

            setFilteredMonasteries(filtered);
            // Reset showAll when filters change
            setShowAll(false);
          }, [searchTerm, selectedRegion, monasteries]);

          const handleSearch = () => {
            // Trigger search (already handled by useEffect)
            console.log('Search triggered');
          };

          if (loading) {
            return (
              <div className="min-h-screen flex items-center justify-center">
                <div className="text-xl text-gray-600">Loading virtual tours...</div>
              </div>
            );
          }

          return (
            <div className="min-h-screen bg-white">
              <SharedNavigation currentPage="tours" theme="light" />
              <Hero
                searchTerm={searchTerm}
                setSearchTerm={setSearchTerm}
                selectedRegion={selectedRegion}
                setSelectedRegion={setSelectedRegion}
                handleSearch={handleSearch}
              />
              <TourGallery
                monasteries={filteredMonasteries}
                showAll={showAll}
                setShowAll={setShowAll}
              />
            </div>
          );
        };

    // Render the App (use createRoot when available)
    const rootEl = document.getElementById('root');
    if (ReactDOM.createRoot) {
      ReactDOM.createRoot(rootEl).render(<App />);
    } else {
      ReactDOM.render(<App />, rootEl);
    }

    // Close dropdown when clicking outside
    document.addEventListener('click', function(e) {
        const dropdownMenu = document.getElementById('languageMenu');
        const dropdownButton = e.target.closest('.language-switcher');

        if (!dropdownButton && dropdownMenu) {
            dropdownMenu.classList.add('hidden');
        }
    });

    // Change language function
    window.changeLanguage = function(langCode, langName) {
        console.log('Changing language to:', langCode, langName);

        // Store the language preference in localStorage
        localStorage.setItem('selectedLanguage', langCode);
        localStorage.setItem('selectedLanguageName', langName);

        // Store the original language name to prevent corruption
        const originalLangName = langName;

        // Update dropdown text immediately and lock it
        const currentLanguage = document.getElementById('currentLanguage');
        if (currentLanguage) {
            currentLanguage.textContent = originalLangName;
            // Add a class to prevent Google Translate from touching this element
            currentLanguage.classList.add('notranslate');
            currentLanguage.setAttribute('translate', 'no');
        }

        // Close dropdown
        const dropdownMenu = document.getElementById('languageMenu');
        if (dropdownMenu) {
            dropdownMenu.classList.add('hidden');
        }

        // Trigger translation
        translatePage(langCode);

        // Ensure the dropdown text remains correct after translation
        setTimeout(() => {
            if (currentLanguage) {
                currentLanguage.textContent = originalLangName;
            }
        }, 1000);

        setTimeout(() => {
            if (currentLanguage) {
                currentLanguage.textContent = originalLangName;
            }
        }, 3000);
    };

    // Function to restore language on page load
    window.restoreLanguageOnLoad = function() {
        const savedLang = localStorage.getItem('selectedLanguage');
        const savedLangName = localStorage.getItem('selectedLanguageName');

        console.log('Restoring language:', savedLang, savedLangName);

        if (savedLang && savedLangName) {
            // ALWAYS update dropdown text immediately based on saved language
            updateDropdownText(savedLang);

            if (savedLang !== 'en') {
                // Trigger translation after a delay to ensure Google Translate is ready
                setTimeout(() => {
                    translatePage(savedLang);
                }, 1000);
            }
        }

        // Also run detection to catch any edge cases
        setTimeout(() => {
            detectCurrentLanguage();
        }, 3000);
    };

    // Initialize language restoration on page load
    document.addEventListener('DOMContentLoaded', function() {
        restoreLanguageOnLoad();
    });

    // Also try to restore immediately (before DOMContentLoaded)
    (function() {
        const savedLang = localStorage.getItem('selectedLanguage');
        if (savedLang) {
            // Try to update dropdown immediately if it exists
            setTimeout(() => {
                updateDropdownText(savedLang);
            }, 100);
        }
    })();

    // Function to trigger translation
    window.translatePage = function(lang) {
        console.log('Translating to:', lang);

        setTimeout(function() {
            const selectElement = document.querySelector('#google_translate_element select');
            if (selectElement) {
                selectElement.value = lang;
                selectElement.dispatchEvent(new Event('change'));
            } else {
                console.log('Google Translate not ready yet...');
                // Retry after a longer delay
                setTimeout(() => {
                    const retrySelect = document.querySelector('#google_translate_element select');
                    if (retrySelect) {
                        retrySelect.value = lang;
                        retrySelect.dispatchEvent(new Event('change'));
                    }
                }, 2000);
            }
        }, 500);
    };

    // Initialize Google Translate
    window.googleTranslateElementInit = function() {
        new google.translate.TranslateElement({
            pageLanguage: 'en',
            includedLanguages: 'en,hi,ne',
            layout: google.translate.TranslateElement.InlineLayout.HORIZONTAL,
            autoDisplay: false
        }, 'google_translate_element');

        // Detect current language after Google Translate loads
        setTimeout(detectCurrentLanguage, 2000);
    };

    // Function to detect and set current language in dropdown
    window.detectCurrentLanguage = function() {
        // Check if Google Translate has translated the page
        const body = document.body;
        const isTranslated = body.classList.contains('translated-ltr') ||
                           body.classList.contains('translated-rtl') ||
                           document.querySelector('.goog-te-menu-value span') ||
                           body.classList.contains('goog-te-rendered');

        if (isTranslated) {
            // Try to get the current language from Google Translate
            const selectElement = document.querySelector('#google_translate_element select');
            if (selectElement && selectElement.value) {
                const currentLang = selectElement.value;
                updateDropdownText(currentLang);
            } else {
                // Fallback: check for language-specific elements or URL params
                checkForLanguageIndicators();
            }
        }

        // Also check periodically in case translation happens later
        setTimeout(detectCurrentLanguage, 5000);
    };

    // Function to check for language indicators in the page
    window.checkForLanguageIndicators = function() {
        const bodyText = document.body.innerText.toLowerCase();

        // Check for Hindi text patterns
        if (/[\u0900-\u097F]/.test(bodyText) || bodyText.includes('à¤•à¥€') || bodyText.includes('à¤¹à¥ˆ') || bodyText.includes('à¤¸à¥‡')) {
            updateDropdownText('hi');
        }
        // Check for Nepali text patterns
        else if (/[\u0900-\u097F]/.test(bodyText) || bodyText.includes('à¤•à¥‹') || bodyText.includes('à¤›') || bodyText.includes('à¤—à¤°à¥à¤¨')) {
            updateDropdownText('ne');
        }
    };

    // Function to update dropdown text based on language code
    window.updateDropdownText = function(langCode) {
        console.log('Updating dropdown text to:', langCode);
        const currentLanguage = document.getElementById('currentLanguage');
        if (!currentLanguage) {
            console.log('currentLanguage element not found, retrying...');
            setTimeout(() => updateDropdownText(langCode), 200);
            return;
        }

        let langName;
        switch(langCode) {
            case 'hi':
                langName = 'à¤¹à¤¿à¤‚à¤¦à¥€';
                break;
            case 'ne':
                langName = 'à¤¨à¥‡à¤ªà¤¾à¤²à¥€';
                break;
            case 'en':
            default:
                langName = 'English';
                break;
        }

        console.log('Setting dropdown text to:', langName);
        currentLanguage.textContent = langName;
        currentLanguage.classList.add('notranslate');
        currentLanguage.setAttribute('translate', 'no');
    };

    // Dropdown functionality
    document.addEventListener('DOMContentLoaded', function() {
        // The dropdown click is handled in React component inline
        // This is just for the outside click closing
        // Already handled above by document click listener
    });
    </script>

    <!-- Hidden Google Translate Element -->
    <div id="google_translate_element" style="display: none;"></div>

    <!-- Google Translate Script -->
    <script type="text/javascript" src="//translate.google.com/translate_a/element.js?cb=googleTranslateElementInit"></script>
</body>
</html>
